cmake_minimum_required (VERSION 2.6)

set(ENGINE_NAME "vkEngine")
set(CORE_ENGINE_NAME "${ENGINE_NAME}_Core")
set(RENDER_SYSTEM_ENGINE_NAME "${ENGINE_NAME}_RenderSystem")
set(VULKAN_RENDERER_ENGINE_NAME "${ENGINE_NAME}_VulkanRenderer")
set(SCENE_ENGINE_NAME "${ENGINE_NAME}_Scene")
set(BIN_DIR "${CMAKE_CURRENT_SOURCE_DIR}/bin")
set(LIB_DIR "${BIN_DIR}")
set(INC_DIR "${CMAKE_CURRENT_SOURCE_DIR}/include/vke")
SET(SRC_DIR "${CMAKE_CURRENT_SOURCE_DIR}/src")
SET(THIRD_PARTY_DIR "${CMAKE_CURRENT_SOURCE_DIR}/src/ThirdParty")
SET(LIB_TYPE)

#MESSAGE("bin dir: '${CMAKE_CURRENT_BINARY_DIR}' '${CMAKE_RUNTIME_OUTPUT_DIRECTORY}' '${CMAKE_LIBRARY_OUTPUT_DIRECTORY}'")

#vkEngine_Core

set(LIB_NAME "${CORE_ENGINE_NAME}")
set(LIB_INCLUDE_DIR_PATH "Core")
set(LIB_SOURCE_DIR_PATH "Core")
SET(LIB_DEPENDENCIES)
SET(LINK_RELEASE_LIBS)
set(LINK_DEBUG_LIBS)
include(EngineLib.cmake NO_POLICY_SCOPE)
set(CORE_ENGINE_NAME_LIB_RELEASE "${LIB_RELEASE_NAME}")
set(CORE_ENGINE_NAME_LIB_DEBUG "${LIB_DEBUG_NAME}")

#vkEngine_RenderSystem
set(LIB_NAME "${RENDER_SYSTEM_ENGINE_NAME}")
set(LIB_INCLUDE_DIR_PATH "RenderSystem")
set(LIB_SOURCE_DIR_PATH "RenderSystem")
SET(LIB_DEPENDENCIES ${CORE_ENGINE_NAME})
SET(LINK_RELEASE_LIBS ${CORE_ENGINE_NAME_LIB_RELEASE})
set(LINK_DEBUG_LIBS ${CORE_ENGINE_NAME_LIB_DEBUG})
include(EngineLib.cmake NO_POLICY_SCOPE)
set(RENDER_SYSTEM_ENGINE_NAME_LIB_RELEASE "${LIB_RELEASE_NAME}")
set(RENDER_SYSTEM_ENGINE_NAME_LIB_DEBUG "${LIB_DEBUG_NAME}")

#vkEngine_VulkanRenderer
set(LIB_NAME "${VULKAN_RENDERER_ENGINE_NAME}")
set(LIB_INCLUDE_DIR_PATH "RenderSystem/Vulkan")
set(LIB_SOURCE_DIR_PATH "RenderSystem/Vulkan")
SET(LIB_DEPENDENCIES ${RENDER_SYSTEM_ENGINE_NAME})
SET(LINK_RELEASE_LIBS ${RENDER_SYSTEM_ENGINE_NAME_LIB_RELEASE})
set(LINK_DEBUG_LIBS ${RENDER_SYSTEM_ENGINE_NAME_LIB_DEBUG})
include(EngineLib.cmake NO_POLICY_SCOPE)
set(VULKAN_RENDERER_ENGINE_NAME_LIB_RELEASE "${LIB_RELEASE_NAME}")
set(VULKAN_RENDERER_ENGINE_NAME_LIB_DEBUG "${LIB_DEBUG_NAME}")


#vkEngine_Scene
set(LIB_NAME "${SCENE_ENGINE_NAME}")
set(LIB_INCLUDE_DIR_PATH "Scene")
set(LIB_SOURCE_DIR_PATH "Scene")
SET(LIB_DEPENDENCIES ${CORE_ENGINE_NAME} ${VULKAN_RENDERER_ENGINE_NAME})
SET(LINK_RELEASE_LIBS ${CORE_ENGINE_NAME_LIB_RELEASE} ${VULKAN_RENDERER_ENGINE_NAME_LIB_RELEASE})
SET(LINK_DEBUG_LIBS ${CORE_ENGINE_NAME_LIB_DEBUG} ${VULKAN_RENDERER_ENGINE_NAME_LIB_DEBUG})
include(EngineLib.cmake NO_POLICY_SCOPE)
set(SCENE_ENGINE_NAME_LIB_RELEASE "${LIB_RELEASE_NAME}")
set(SCENE_ENGINE_NAME_LIB_DEBUG "${LIB_DEBUG_NAME}")

#vkEngine
SET(LIB_TYPE SHARED)
set(LIB_NAME "${ENGINE_NAME}")
SET(FILES_RECURSE_DISABLED 1)
set(LIB_INCLUDE_FILES "${INC_DIR}/CVKEngine.h" "${INC_DIR}/../VKE.h")
set(LIB_SOURCE_FILES "${SRC_DIR}/CVKEngine.cpp" "${SRC_DIR}/DllMain.cpp")
SET(LIB_DEPENDENCIES ${CORE_ENGINE_NAME} ${VULKAN_RENDERER_ENGINE_NAME} ${SCENE_ENGINE_NAME})
SET(LINK_RELEASE_LIBS ${CORE_ENGINE_NAME_LIB_RELEASE} ${VULKAN_RENDERER_ENGINE_NAME_LIB_RELEASE} ${SCENE_ENGINE_NAME_LIB_RELEASE})
SET(LINK_DEBUG_LIBS ${CORE_ENGINE_NAME_LIB_DEBUG} ${VULKAN_RENDERER_ENGINE_NAME_LIB_DEBUG} ${SCENE_ENGINE_NAME_LIB_DEBUG})
include(EngineLib.cmake NO_POLICY_SCOPE)
set(VK_ENGINE_NAME_LIB_RELEASE "${LIB_RELEASE_NAME}")
set(VK_ENGINE_NAME_LIB_DEBUG "${LIB_DEBUG_NAME}")


# SAMPLES

set(SAMPLE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/samples")
set(INC_DIR "${CMAKE_CURRENT_SOURCE_DIR}/include")
SUBDIRLIST(SAMPLE_SUBDIRS ${SAMPLE_DIR})

foreach(DIR ${SAMPLE_SUBDIRS})
    message(${DIR})
    set(FULLPATH_DIR "${SAMPLE_DIR}/${DIR}")
    project(${DIR} C CXX)
    set(APP_RELEASE_NAME "${PROJECT_NAME}${ARCHITECTURE}")
    set(APP_DEBUG_NAME "${APP_RELEASE_NAME}_d")
    file(GLOB_RECURSE FILES ${FULLPATH_DIR}/*.h ${FULLPATH_DIR}/*.cpp)
    
    include_directories(${INC_DIR})
    link_directories(${LIB_DIR} ${BIN_DIR} ${LIB_SYMBOL_DEBUG_DIR} ${LIB_SYMBOL_RELEASE_DIR})
    
    add_executable(${PROJECT_NAME} ${FILES})
    add_dependencies(${PROJECT_NAME} vkEngine)
    message("${PROJECT_NAME}->${ENGINE_NAME}")
    
    set_target_properties(${PROJECT_NAME} PROPERTIES OUTPUT_NAME_DEBUG ${APP_DEBUG_NAME})
    set_target_properties(${PROJECT_NAME} PROPERTIES OUTPUT_NAME_RELEASE ${APP_RELEASE_NAME})
    set_target_properties(${PROJECT_NAME} PROPERTIES RUNTIME_OUTPUT_DIRECTORY_DEBUG ${BIN_DIR})
    set_target_properties(${PROJECT_NAME} PROPERTIES RUNTIME_OUTPUT_DIRECTORY_RELEASE ${BIN_DIR})
    
    set(LINK_LIB optimized ${LIB_RELEASE_NAME} debug ${LIB_DEBUG_NAME})
    target_link_libraries(${PROJECT_NAME} ${LINK_LIB})
endforeach()